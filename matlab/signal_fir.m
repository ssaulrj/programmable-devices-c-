%Filtraje FIR--------------------------------------------------------------
clear all; close all; clc;
Fs = 16000;
n = 0:1/Fs:0.1;
f = -Fs/2:Fs/1024:(Fs/2)-(Fs/1024);
x = sin(2*pi*500*n) + sin(2*pi*750*n) + sin(2*pi*1000*n);
X2 = fftshift(fft(x,1024));

h = [0.0154841401637762 -0.0141086459734070 -0.00786187678380364 -0.00349667725114399 -0.000529434537010905 0.00140885954106257 0.00257206517182088 0.00313950609828064 0.00323187946127460 0.00293049279017570 0.00230975729356378 0.00144177029622463 0.000409473767766715 -0.000681648665317246 -0.00171597402603496 -0.00257415683271368 -0.00314319519234525 -0.00333748624400575 -0.00310864201162574 -0.00245367147263905 -0.00142633899734616 -0.000136397497943289 0.00126304843397918 0.00259392406018348 0.00367319053214652 0.00433461947987337 0.00445435786390270 0.00397353840965038 0.00291136047274671 0.00136618997112091 -0.000491777051228549 -0.00243303695107533 -0.00419579014295825 -0.00552404994331981 -0.00620187903472424 -0.00608297251898219 -0.00511516552796835 -0.00336016619246275 -0.000997027791234643 0.00170502863577033 0.00441097773739432 0.00674495881043686 0.00835663162694276 0.00896875345558160 0.00839814216179607 0.00661559541725948 0.00375369830131597 8.60703857230413e-05 -0.00396072058597718 -0.00786727311396264 -0.0111212916372324 -0.0131522352509503 -0.0136199749507922 -0.0122330323059677 -0.00896157873714571 -0.00404769155054904 0.00208435656398128 0.00878792156600931 0.0152282257713140 0.0205076878972727 0.0237535238518281 0.0241902424240740 0.0212299398251059 0.0145647476378445 0.00423080868912885 -0.00938623860668096 -0.0255792245535625 -0.0433592295068916 -0.0615271795672307 -0.0787768724820200 -0.0938151472974901 -0.105486222070348 -0.112879234313326 0.884589391053800 -0.112879234313326 -0.105486222070348 -0.0938151472974901 -0.0787768724820200 -0.0615271795672307 -0.0433592295068916 -0.0255792245535625 -0.00938623860668096 0.00423080868912885 0.0145647476378445 0.0212299398251059 0.0241902424240740 0.0237535238518281 0.0205076878972727 0.0152282257713140 0.00878792156600931 0.00208435656398128 -0.00404769155054904 -0.00896157873714571 -0.0122330323059677 -0.0136199749507922 -0.0131522352509503 -0.0111212916372324 -0.00786727311396264 -0.00396072058597718 8.60703857230413e-05 0.00375369830131597 0.00661559541725948 0.00839814216179607 0.00896875345558160 0.00835663162694276 0.00674495881043686 0.00441097773739432 0.00170502863577033 -0.000997027791234643 -0.00336016619246275 -0.00511516552796835 -0.00608297251898219 -0.00620187903472424 -0.00552404994331981 -0.00419579014295825 -0.00243303695107533 -0.000491777051228549 0.00136618997112091 0.00291136047274671 0.00397353840965038 0.00445435786390270 0.00433461947987337 0.00367319053214652 0.00259392406018348 0.00126304843397918 -0.000136397497943289 -0.00142633899734616 -0.00245367147263905 -0.00310864201162574 -0.00333748624400575 -0.00314319519234525 -0.00257415683271368 -0.00171597402603496 -0.000681648665317246 0.000409473767766715 0.00144177029622463 0.00230975729356378 0.00293049279017570 0.00323187946127460 0.00313950609828064 0.00257206517182088 0.00140885954106257 -0.000529434537010905 -0.00349667725114399 -0.00786187678380364 -0.0141086459734070 0.0154841401637762];
lh = length(h);
input_sample = 1:10;
Nx = length(x);
yy = conv(h,x);
X= zeros(1,Nx+lh-1);
for nn = 1: Nx + lh -1
    if(nn <= Nx)
        X(1) = x(nn);
    else
        X(1) = 0;
    end
    y(nn) = 0;
    for k = 1:lh
        y(nn) = y(nn) + (h(k)*X(k));
    end 
    for m = lh : -1:2
        
       X(m) = X(m-1);
    end
    y;
    yy;  
end
Y2 = fftshift(fft(yy,1024));
z = 0;
fs = 16000;
ff = 0 : (1/fs) : (length(y)/fs)-(1/fs); 
mx = max(x);
mX2 = max(abs(X2));
z = mX2/mx;

myy = max(yy);
mY2 = max(abs(Y2));
z2 = mY2/myy;

figure(1)
subplot(2,2,1)
plot(n,x);xlim([0 0.01]);
title('Se単al senoidal')
xlabel('Tiempo')
ylabel('Amplitud')
subplot(2,2,3)
plot(ff,y);xlim([0 0.01]);
title('Se単al senoidal filtrada FIR')
xlabel('Tiempo')
ylabel('Amplitud')

subplot(2,2,2)
plot(f,abs(X2)/z); xlim([-2000 2000]);
title('Espectro se単al senoidal')
xlabel('Frecuencia')
ylabel('Amplitud')
subplot(2,2,4)
plot(f,abs(Y2)/z2); xlim([-2000 2000]);
title('Espectro se単al senoidal filtrada FIR')
xlabel('Frecuencia')
ylabel('Amplitud')
    
